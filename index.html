<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FLAG.IO - Stable</title>
    <style>
        :root { --neon: #00ffcc; --bg: #050505; }
        body { margin: 0; overflow: hidden; background: var(--bg); font-family: sans-serif; touch-action: none; color: white; }
        canvas { display: block; position: absolute; z-index: 1; }

        /* UI */
        #ui-layer { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 10px; border: 1px solid var(--neon); pointer-events: none; z-index: 10; font-size: 12px; }
        #overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .menu-box { background: #111; padding: 25px; border-radius: 20px; border: 2px solid var(--neon); text-align: center; width: 280px; }
        
        input { width: 85%; padding: 10px; margin: 10px 0; background: #000; border: 1px solid #333; color: white; border-radius: 8px; text-align: center; font-size: 16px; outline: none; }
        .flag-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 15px; }
        .flag { font-size: 24px; cursor: pointer; opacity: 0.4; }
        .flag.active { opacity: 1; transform: scale(1.2); }
        .btn { width: 100%; padding: 15px; background: var(--neon); border: none; border-radius: 10px; font-weight: bold; cursor: pointer; color: #000; margin-top: 8px; text-transform: uppercase; }
        #revive-btn { background: #ffcc00; display: none; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div style="color:var(--neon); text-align:center; font-weight:bold; margin-bottom:5px;">TOP RANKING</div>
        <div id="lb-content"></div>
    </div>

    <div id="overlay">
        <div class="menu-box">
            <h1 style="color:var(--neon); margin:0;">FLAG.IO</h1>
            <input type="text" id="nick" placeholder="NICKNAME" maxlength="10">
            <div class="flag-grid">
                <span class="flag active" onclick="setF(this, 'ðŸ‡¹ðŸ‡·')">ðŸ‡¹ðŸ‡·</span>
                <span class="flag" onclick="setF(this, 'ðŸ‡ºðŸ‡¸')">ðŸ‡ºðŸ‡¸</span>
                <span class="flag" onclick="setF(this, 'ðŸ‡©ðŸ‡ª')">ðŸ‡©ðŸ‡ª</span>
                <span class="flag" onclick="setF(this, 'ðŸ‡§ðŸ‡·')">ðŸ‡§ðŸ‡·</span>
                <span class="flag" onclick="setF(this, 'ðŸ‡¬ðŸ‡§')">ðŸ‡¬ðŸ‡§</span>
                <span class="flag" onclick="setF(this, 'ðŸ‡«ðŸ‡·')">ðŸ‡«ðŸ‡·</span>
                <span class="flag" onclick="setF(this, 'ðŸ‡¯ðŸ‡µ')">ðŸ‡¯ðŸ‡µ</span>
                <span class="flag" onclick="setF(this, 'ðŸ‡®ðŸ‡¹')">ðŸ‡®ðŸ‡¹</span>
            </div>
            <button id="revive-btn" class="btn" onclick="revive()">REVIVE (X0.5)</button>
            <button class="btn" onclick="play(true)">START GAME</button>
            <div style="margin-top:10px;"><iframe id="ad-frame" width="280" height="80" frameborder="0"></iframe></div>
        </div>
    </div>

    <canvas id="c"></canvas>

<script>
    const canvas = document.getElementById('c'), ctx = canvas.getContext('2d');
    const adL = "https://omg10.com/4/10619187";
    
    // Oyun AyarlarÄ±
    let active = false, worldSize = 4000;
    let player = { x: 2000, y: 2000, r: 35, n: "Guest", z: 1, f: "ðŸ‡¹ðŸ‡·", protected: 0 };
    let foods = [], bots = [], viruses = [], lastMass = 35;
    let joy = { active: false, base: {x:0, y:0}, stick: {x:0, y:0}, dir: {x:0, y:0} };

    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.addEventListener('resize', resize); resize();

    // Kontroller
    window.addEventListener('touchstart', e => { 
        if(!active) return;
        joy.active = true;
        joy.base = {x: e.touches[0].clientX, y: e.touches[0].clientY};
        joy.stick = {...joy.base};
    });
    window.addEventListener('touchmove', e => {
        if(!joy.active) return; e.preventDefault();
        let t = e.touches[0], dx = t.clientX - joy.base.x, dy = t.clientY - joy.base.y, d = Math.hypot(dx, dy), max = 50;
        if(d > max) { joy.stick.x = joy.base.x + (dx/d)*max; joy.stick.y = joy.base.y + (dy/d)*max; }
        else { joy.stick.x = t.clientX; joy.stick.y = t.clientY; }
        joy.dir = {x: dx/max, y: dy/max};
    }, {passive: false});
    window.addEventListener('touchend', () => { joy.active = false; joy.dir = {x:0, y:0}; });

    function setF(el, f) { document.querySelectorAll('.flag').forEach(x => x.classList.remove('active')); el.classList.add('active'); player.f = f; }
    function spawnF() { foods.push({ x: Math.random()*worldSize, y: Math.random()*worldSize, r: 5, c: `hsl(${Math.random()*360}, 70%, 60%)` }); }
    function spawnB() { bots.push({ x: Math.random()*worldSize, y: Math.random()*worldSize, r: 25 + Math.random()*60, f: 'ðŸ‡ºðŸ‡¸', n: "Bot_"+Math.floor(Math.random()*99), vx: (Math.random()-0.5)*2, vy: (Math.random()-0.5)*2 }); }
    function spawnV() { viruses.push({ x: Math.random()*worldSize, y: Math.random()*worldSize, r: 60 }); }

    function play(isNew) {
        if(isNew) { 
            foods = []; bots = []; viruses = [];
            for(let i=0; i<300; i++) spawnF(); 
            for(let i=0; i<10; i++) spawnB();
            for(let i=0; i<6; i++) spawnV();
            player.r = 35;
        }
        player.x = 500 + Math.random()*(worldSize-1000);
        player.y = 500 + Math.random()*(worldSize-1000);
        player.n = document.getElementById('nick').value || "Guest";
        player.protected = Date.now() + 3000;
        active = true;
        document.getElementById('overlay').style.display = 'none';
        document.getElementById('revive-btn').style.display = 'none';
        document.getElementById('ad-frame').src = "about:blank";
        requestAnimationFrame(upd);
    }

    function revive() { window.open(adL, '_blank'); player.r = Math.max(35, lastMass / 2); play(false); }

    function upd() {
        if(!active) return;
        let now = Date.now();
        let s = Math.max(1.2, 4.5 - (player.r / 80));
        player.x += joy.dir.x * s; player.y += joy.dir.y * s;
        player.x = Math.max(player.r, Math.min(worldSize-player.r, player.x));
        player.y = Math.max(player.r, Math.min(worldSize-player.r, player.y));
        player.z += (Math.max(0.3, 45/player.r) - player.z) * 0.05;

        ctx.setTransform(1,0,0,1,0,0);
        ctx.fillStyle = '#050505'; ctx.fillRect(0,0,canvas.width, canvas.height);

        // Joystick Ã‡izimi
        if(joy.active) {
            ctx.strokeStyle = 'rgba(0, 255, 204, 0.3)'; ctx.lineWidth = 3;
            ctx.beginPath(); ctx.arc(joy.base.x, joy.base.y, 50, 0, Math.PI*2); ctx.stroke();
            ctx.fillStyle = 'rgba(0, 255, 204, 0.2)';
            ctx.beginPath(); ctx.arc(joy.stick.x, joy.stick.y, 25, 0, Math.PI*2); ctx.fill();
        }

        ctx.translate(canvas.width/2, canvas.height/2);
        ctx.scale(player.z, player.z); ctx.translate(-player.x, -player.y);

        // Grid (Izgara)
        ctx.strokeStyle = '#111'; ctx.lineWidth = 2;
        for(let i=0; i<=worldSize; i+=200) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,worldSize); ctx.stroke(); ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(worldSize,i); ctx.stroke(); }

        // Viruses (Dikenler)
        viruses.forEach((v, i) => {
            ctx.fillStyle = '#44ff44'; ctx.beginPath();
            for(let a=0; a<20; a++) {
                let r = a%2==0 ? v.r : v.r-15;
                let angle = (a/20)*Math.PI*2;
                ctx.lineTo(v.x + Math.cos(angle)*r, v.y + Math.sin(angle)*r);
            }
            ctx.closePath(); ctx.fill();
            if(Math.hypot(player.x-v.x, player.y-v.y) < player.r + v.r - 20) {
                if(player.r > v.r + 5) { player.r *= 0.75; viruses.splice(i,1); spawnV(); }
            }
        });

        // Yemekler
        foods.forEach((f, i) => {
            ctx.fillStyle = f.c; ctx.beginPath(); ctx.arc(f.x, f.y, f.r, 0, Math.PI*2); ctx.fill();
            if(Math.hypot(player.x-f.x, player.y-f.y) < player.r) { foods.splice(i,1); player.r += 0.8; spawnF(); }
        });

        // Botlar
        bots.forEach((b, i) => {
            b.x += b.vx; b.y += b.vy;
            if(b.x < b.r || b.x > worldSize-b.r) b.vx *= -1;
            if(b.y < b.r || b.y > worldSize-b.r) b.vy *= -1;
            ctx.font = `${b.r * 1.3}px Arial`; ctx.textAlign="center"; ctx.textBaseline="middle";
            ctx.fillText(b.f, b.x, b.y);
            
            if(Math.hypot(player.x-b.x, player.y-b.y) < player.r + b.r - 15) {
                if(now < player.protected) return;
                if(player.r > b.r * 1.15) { bots.splice(i,1); player.r += b.r/4; spawnB(); }
                else if(b.r > player.r * 1.15) { 
                    active = false; lastMass = player.r;
                    document.getElementById('overlay').style.display='flex'; 
                    document.getElementById('revive-btn').style.display='block';
                    document.getElementById('ad-frame').src=adL;
                }
            }
        });

        // Oyuncu
        ctx.save();
        if(now < player.protected) ctx.globalAlpha = 0.5;
        ctx.font = `${player.r * 1.3}px Arial`; ctx.textAlign="center"; ctx.textBaseline="middle";
        ctx.fillText(player.f, player.x, player.y);
        ctx.restore();

        // Leaderboard
        if(Math.floor(now/500)%2===0) {
            let lb = bots.map(x=>({n:x.n, s:Math.floor(x.r)})).concat([{n:player.n, s:Math.floor(player.r), me:true}]).sort((a,b)=>b.s-a.s);
            document.getElementById('lb-content').innerHTML = lb.slice(0,5).map(x=>`<div class="lb-item ${x.me?'me':''}"><span>${x.n}</span><span>${x.s}</span></div>`).join('');
        }
        requestAnimationFrame(upd);
    }
</script>
</body>
</html>
